<!DOCTYPE html>
<html>
<head>
  <title>Admin Panel</title>
  <style>
    table, th, td {
      border: 1px solid black;
      border-collapse: collapse;
      padding: 6px;
    }
    input, select {
      margin: 4px;
    }
  </style>
</head>
<body>
  <h2>Admin Panel</h2>

  <div>
    <h3>Add New User</h3>
    <input type="text" id="userId" placeholder="User ID (e.g., S001)" />
    <input type="text" id="userName" placeholder="Name" />
    <select id="userRole">
      <option value="student">Student</option>
      <option value="teacher">Teacher</option>
    </select>
    <input type="password" id="userPassword" placeholder="Password" />
    <button onclick="addUser()">Add User</button>
  </div>

  <div>
    <h3>All Users</h3>
    <table id="userTable">
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Role</th>
          <th>Password</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    // Ensure only admin can access
    const currentUserId = localStorage.getItem("currentUserId");
    const currentUserRole = localStorage.getItem("currentUserRole");
    if (currentUserId !== "admin") {
      alert("Access denied. Only admin can access this page.");
      location.href = "login.html"; // redirect
    }

    const userTableBody = document.querySelector("#userTable tbody");

    function loadUsers() {
      const users = JSON.parse(localStorage.getItem("users") || "[]");
      userTableBody.innerHTML = "";
      users.forEach((user, index) => {
        userTableBody.innerHTML += `
          <tr>
            <td>${user.id}</td>
            <td>${user.name}</td>
            <td>${user.role}</td>
            <td>${user.password}</td>
            <td><button onclick="deleteUser(${index})">❌ Delete</button></td>
          </tr>
        `;
      });
    }

    function addUser() {
      const id = document.getElementById("userId").value.trim();
      const name = document.getElementById("userName").value.trim();
      const role = document.getElementById("userRole").value;
      const password = document.getElementById("userPassword").value.trim();

      if (!id || !name || !password) return alert("All fields are required.");

      let users = JSON.parse(localStorage.getItem("users") || "[]");

      if (users.some(u => u.id === id)) {
        alert("User with this ID already exists.");
        return;
      }

      users.push({ id, name, role, password });
      localStorage.setItem("users", JSON.stringify(users));

      alert("✅ User added.");
      loadUsers();
    }

    function deleteUser(index) {
      if (!confirm("Are you sure you want to delete this user?")) return;

      let users = JSON.parse(localStorage.getItem("users") || "[]");
      users.splice(index, 1);
      localStorage.setItem("users", JSON.stringify(users));
      loadUsers();
    }

    // Initial load
    loadUsers();
  </script>
</body>
</html>
